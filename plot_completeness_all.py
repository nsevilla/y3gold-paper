import os,sys
import matplotlib
matplotlib.use("Agg")
from matplotlib import pyplot as plt
import numpy as np
import warnings
from descolors import BAND_COLORS
warnings.filterwarnings('ignore')

matplotlib.style.use('des_dr1')
binning = 10
minmax = [19,25]
midbins = np.empty(binning)
interval = float(minmax[1]-minmax[0])/float(binning)
for i in range(binning):
    lo = minmax[0]+i*interval
    midbins[i] = lo + interval*0.5

region = 'w02'
band_select = 'i'

if region == 'w02':
    if band_select == 'g':
        # g-band
        hsc = [0.89945652,0.92552135,0.93206522,0.9295313,0.92632576,0.93430697,0.93907494,0.92017705,0.7280222,0.31366957]
        dhsc = [0.02853046, 0.02143165, 0.01591257, 0.01234128, 0.00936547, 0.00720278, 0.00529185, 0.0037347 , 0.00241628, 0.00124944]
        deep = [0.96485623, 0.96153846, 0.97463768, 0.97404002, 0.97401378, 0.96740614, 0.95644233, 0.9219066 , 0.72931765, 0.33024721]
        ddeep = [0.05543247, 0.03922318, 0.02969889, 0.02294576, 0.01746011, 0.0128475 , 0.00934507, 0.00650944, 0.00427653, 0.00230394]
        balrog = [0.94029851, 0.97413793, 0.99      , 0.97313433, 0.97385621, 0.95268542, 0.94053315, 0.88712121, 0.67537688, 0.30602094]
        dbalrog = [0.11757907, 0.09124334, 0.07018013, 0.05381642, 0.04601161, 0.03488137, 0.02534641, 0.01832767, 0.01165019, 0.0063285 ]
        dbalrog_lo = []
        dbalrog_hi = []
    elif band_select == 'r':
        # r-band
        hsc = [0.95576727, 0.94610778, 0.94491327, 0.93919067, 0.94076351, 0.94253941, 0.93387198, 0.8417624 , 0.42797702, 0.06442153]
        dhsc = [0.01803028, 0.01351728, 0.01052313, 0.00827491, 0.00656995, 0.00515119, 0.00393214, 0.00282933, 0.00157048, 0.00052099]
        deep = [0.97462514, 0.97256858, 0.97518137, 0.97557635, 0.96650923, 0.96146452, 0.94502618, 0.85680206, 0.48092339, 0.08132125]
        ddeep = [0.03350878, 0.02461629, 0.01929266, 0.01492088, 0.01176052, 0.00916555, 0.00696457, 0.00515213, 0.00301536, 0.00105116]
        balrog = [0.98901099, 0.99227799, 0.97704082, 0.97406807, 0.95228216,0.93994778, 0.92431762, 0.80875123, 0.4305047 , 0.08125748]
        dbalrog = [0.07351373, 0.06177699, 0.04986073, 0.03970085, 0.03141369, 0.02476171, 0.01954756, 0.0140982 , 0.00827828, 0.00297289]
        dbalrog_lo = [0.0237, 0.017 , 0.0187, 0.0148, 0.015 , 0.0132, 0.0111, 0.0126, 0.0124, 0.0056]
        dbalrog_hi = [0.0092, 0.0063, 0.0115, 0.0105, 0.012 , 0.0107, 0.01  , 0.0116, 0.0121, 0.0056]
    elif band_select == 'i':
        # i-band
        hsc = [0.96713819, 0.95220109, 0.9509431 , 0.95254596, 0.95157812, 0.95051606, 0.92007991, 0.68977651, 0.19319565, 0.01364685]
        dhsc = [0.01450622, 0.01113556, 0.00859116, 0.00677065, 0.00537641, 0.00428217, 0.00337879, 0.00233807, 0.00100683, 0.00023994]
        dhsc_lo = [0.006, 0.005, 0.004, 0.003, 0.003, 0.002, 0.002, 0.003, 0.002, 0.001]
        dhsc_hi = [0.005, 0.005, 0.004, 0.003, 0.002, 0.002, 0.002, 0.003, 0.002, 0.001]
        #deep = [0.85338346,0.87583149,0.89223664,0.91651792,0.92492807,0.93159281,0.88766169,0.65700436,0.19303728,0.01098177]
        #ddeep = [0.02311637,0.01798731,0.01400651,0.01121723,0.00897992,0.00722427,0.0057357,0.00401055,0.00180573,0.0003842 ]
        deep = [0.98769008, 0.98486123, 0.98298906, 0.97943596, 0.97638154, 0.96755889, 0.92260271, 0.68481848, 0.20192617, 0.0122371] #Galaxies
        ddeep = [0.02673352, 0.02034653, 0.01545385, 0.01199351, 0.00943552, 0.00744673, 0.0058889 , 0.00410685, 0.00184871, 0.00040565]
        ddeep_lo = [0.007, 0.007, 0.005, 0.004, 0.003, 0.003, 0.004, 0.006, 0.004, 0.001]
        ddeep_hi = [0.005, 0.004, 0.004, 0.003, 0.003, 0.003, 0.003, 0.004, 0.003, 0.001]
        #balrog v1.0
        #balrog = [0.99193548, 0.98378378, 0.97945205, 0.95715778, 0.9537931, 0.92883379, 0.86931474, 0.60864248, 0.16718266, 0.02179276]
        #dbalrog = [0.06741499,0.05367985,0.04247795,0.03370428,0.02708791,0.02208409,0.01727339,0.01204908,0.00603716,0.00195396]
        #dbalrog_lo = [0.0176, 0.0171, 0.0139, 0.0146, 0.012 , 0.0113, 0.0123, 0.0143, 0.0089, 0.003]
        #dbalrog_hi = [0.0067, 0.0094, 0.0094, 0.0112, 0.0097, 0.0103, 0.0108, 0.0131, 0.0085, 0.0029]
        #balrog v1.4
        balrog = [0.979757, 0.980226, 0.981785, 0.95955, 0.962043, 0.93835, 0.87832, 0.60821, 0.15564, 0.01469]
        dbalrog_lo = [0.025, 0.019, 0.014, 0.014, 0.012, 0.011, 0.014, 0.016, 0.009, 0.003]
        dbalrog_hi = [0.012, 0.011, 0.009, 0.012, 0.009, 0.01 , 0.01 , 0.013, 0.009, 0.003]
    else:
        # z-band
        hsc = [0.95381655, 0.95648061, 0.94956797, 0.94528822, 0.93976091, 0.90861193, 0.74306009, 0.36836804, 0.07286178, 0.00489418]
        dhsc = [0.01236644, 0.00951218, 0.00732282, 0.00577815, 0.0045696 , 0.00362155, 0.00267065, 0.00155218, 0.00059649, 0.00015272]
        deep = [0.95630531, 0.97307335, 0.97230374, 0.9676235 , 0.9579279 , 0.92172561, 0.76714779, 0.41809822, 0.09322663, 0.00641721]
        ddeep = [0.02299212, 0.0173515 , 0.01335313, 0.01037522, 0.00818863, 0.00649345, 0.00486407, 0.00298327, 0.00121308, 0.00029506]
        balrog = [0.98684211, 0.98704104, 0.96996245, 0.956743  , 0.93659323, 0.88946396, 0.71760059, 0.36873783, 0.08915418, 0.01426174]
        dbalrog = [0.05688157, 0.04612194, 0.03482027, 0.02847452, 0.02242774, 0.0181301 , 0.01330781, 0.00807857, 0.00336469, 0.00122287]
        dbalrog_lo = []
        dbalrog_hi = []

    plt.errorbar(midbins,hsc,yerr=[dhsc_lo, dhsc_hi],color='red',marker='o',label='vs. HSC completeness')
    plt.errorbar(midbins,deep,yerr=[ddeep_lo, ddeep_hi],color='blue',marker='o',linestyle = '--',label='Deep fields completeness')
    plt.errorbar(midbins,balrog,yerr=[dbalrog_lo, dbalrog_hi],color='black',marker='o',linestyle = '-.',label='Balrog completeness')

    plt.xticks(np.arange(minmax[0], minmax[1]+1, 0.5))
    plt.hlines(0.90,minmax[0],minmax[1])
    #plt.xlabel("bdf_mag_"+band_select+"/sof_cm_"+band_select,fontsize=14)
    plt.xlabel(band_select+"-band model magnitude")
    plt.ylabel('Detection completeness')
    plt.ylim(0.0,1.0)
    plt.title('Detection completeness for extended objects, SN-X3 field')
    plt.legend(loc='lower left')
    plt.grid(True)
    plt.savefig('figs/completeness_galaxies_snx3_v4_test.png')

elif region == 'w05':
    
    y1 = [0.94517152, 0.94365193, 0.94322503, 0.94030148, 0.93779664, 0.93818776, 0.91517083, 0.71908481, 0.23651629, 0.02016418]
    dy1 = [0.00468223, 0.00355227, 0.00274058, 0.00214611, 0.00172017, 0.00138502, 0.00110175, 0.00078118, 0.00037916, 0.00017321]
    dy1_lo = [0.003, 0.002, 0.002, 0.002, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001]
    dy1_hi = [0.002, 0.002, 0.002, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001]    
    #y3 = [0.95782975, 0.95531109, 0.95404163, 0.95007178, 0.94570182, 0.945727, 0.9362516 , 0.83117842, 0.38840075, 0.04873621]
    y3 = [0.95939377, 0.95679525, 0.95601208, 0.95087476, 0.94652536, 0.94623255, 0.93453773, 0.81270723, 0.35411469, 0.04146726]
    dy3 = [0.00471707, 0.00357662, 0.00275889, 0.00216035, 0.0017304, 0.00139386, 0.00111866, 0.00084594, 0.00047968, 0.00021379]
    dy3_lo = [0.002, 0.002, 0.002, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001]
    dy3_hi = [0.002, 0.002, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001]    

    plt.errorbar(midbins,y1,yerr=dy1,color='red',marker='o',label='Y1 Gold completeness')
    plt.errorbar(midbins,y3,yerr=dy3,color='blue',marker='o',linestyle = '--',label='Y3 Gold completeness')

    plt.xticks(np.arange(minmax[0], minmax[1]+1, 0.5))
    plt.hlines(0.90,minmax[0],minmax[1])
    plt.xlabel(band_select+"-band model magnitude")
    plt.ylabel('Detection completeness')
    plt.ylim(0.0,1.0)
    plt.title('Detection completeness for extended objects, HSC W05 field')
    plt.legend(loc='lower left')
    plt.grid(True)
    plt.savefig('figs/completeness_galaxies_w05_v3.png')
