import os,sys
import matplotlib
matplotlib.use("Agg")
from matplotlib import pyplot as plt
import numpy as np
import warnings
from descolors import BAND_COLORS
warnings.filterwarnings('ignore')

matplotlib.style.use('des_dr1')
binning = 10
minmax = [19,25]
midbins = np.empty(binning)
interval = float(minmax[1]-minmax[0])/float(binning)
for i in range(binning):
    lo = minmax[0]+i*interval
    midbins[i] = lo + interval*0.5

region = 'w05'
band_select = 'i'

if region == 'w02':
    if band_select == 'g':
        # g-band
        hsc = [0.89945652,0.92552135,0.93206522,0.9295313,0.92632576,0.93430697,0.93907494,0.92017705,0.7280222,0.31366957]
        dhsc = [0.02853046, 0.02143165, 0.01591257, 0.01234128, 0.00936547, 0.00720278, 0.00529185, 0.0037347 , 0.00241628, 0.00124944]
        deep = [0.96485623, 0.96153846, 0.97463768, 0.97404002, 0.97401378, 0.96740614, 0.95644233, 0.9219066 , 0.72931765, 0.33024721]
        ddeep = [0.05543247, 0.03922318, 0.02969889, 0.02294576, 0.01746011, 0.0128475 , 0.00934507, 0.00650944, 0.00427653, 0.00230394]
        balrog = [0.94029851, 0.97413793, 0.99      , 0.97313433, 0.97385621, 0.95268542, 0.94053315, 0.88712121, 0.67537688, 0.30602094]
        dbalrog = [0.11757907, 0.09124334, 0.07018013, 0.05381642, 0.04601161, 0.03488137, 0.02534641, 0.01832767, 0.01165019, 0.0063285 ]
    elif band_select == 'r':
        # r-band
        hsc = [0.95576727, 0.94610778, 0.94491327, 0.93919067, 0.94076351, 0.94253941, 0.93387198, 0.8417624 , 0.42797702, 0.06442153]
        dhsc = [0.01803028, 0.01351728, 0.01052313, 0.00827491, 0.00656995, 0.00515119, 0.00393214, 0.00282933, 0.00157048, 0.00052099]
        deep = [0.97462514, 0.97256858, 0.97518137, 0.97557635, 0.96650923, 0.96146452, 0.94502618, 0.85680206, 0.48092339, 0.08132125]
        ddeep = [0.03350878, 0.02461629, 0.01929266, 0.01492088, 0.01176052, 0.00916555, 0.00696457, 0.00515213, 0.00301536, 0.00105116]
        balrog = [0.98901099, 0.99227799, 0.97704082, 0.97406807, 0.95228216,0.93994778, 0.92431762, 0.80875123, 0.4305047 , 0.08125748]
        dbalrog = [0.07351373, 0.06177699, 0.04986073, 0.03970085, 0.03141369, 0.02476171, 0.01954756, 0.0140982 , 0.00827828, 0.00297289]
    elif band_select == 'i':
        # i-band
        hsc = [0.95696417,0.94781187,0.94384806,0.94510316,0.9406031,0.9364471,0.8943077,0.6391466,0.16075578,0.00815729]
        dhsc = [0.01424193,0.01091681,0.0084171,0.00664201,0.00526291,0.0041819,0.00328406,0.00222477,0.0009121,0.00018626]
        #deep = [0.85338346,0.87583149,0.89223664,0.91651792,0.92492807,0.93159281,0.88766169,0.65700436,0.19303728,0.01098177]
        #ddeep = [0.02311637,0.01798731,0.01400651,0.01121723,0.00897992,0.00722427,0.0057357,0.00401055,0.00180573,0.0003842 ]
        deep = [0.97827661,0.97729184,0.97545565,0.97209166,0.96434434,0.95288588,0.90023682,0.66095266,0.19341243,0.0109865]
        ddeep = [0.02660582,0.02026819,0.01539452,0.01194846,0.00937718,0.00739005,0.00581708,0.00403465,0.00180932,0.00038437]
        balrog = [0.99193548, 0.98378378, 0.97945205, 0.95715778, 0.9537931, 0.92883379, 0.86931474, 0.60864248, 0.16718266, 0.02179276]
        dbalrog = [0.06741499,0.05367985,0.04247795,0.03370428,0.02708791,0.02208409,0.01727339,0.01204908,0.00603716,0.00195396]
    else:
        # z-band
        hsc = [0.95381655, 0.95648061, 0.94956797, 0.94528822, 0.93976091, 0.90861193, 0.74306009, 0.36836804, 0.07286178, 0.00489418]
        dhsc = [0.01236644, 0.00951218, 0.00732282, 0.00577815, 0.0045696 , 0.00362155, 0.00267065, 0.00155218, 0.00059649, 0.00015272]
        deep = [0.95630531, 0.97307335, 0.97230374, 0.9676235 , 0.9579279 , 0.92172561, 0.76714779, 0.41809822, 0.09322663, 0.00641721]
        ddeep = [0.02299212, 0.0173515 , 0.01335313, 0.01037522, 0.00818863, 0.00649345, 0.00486407, 0.00298327, 0.00121308, 0.00029506]
        balrog = [0.98684211, 0.98704104, 0.96996245, 0.956743  , 0.93659323, 0.88946396, 0.71760059, 0.36873783, 0.08915418, 0.01426174]
        dbalrog = [0.05688157, 0.04612194, 0.03482027, 0.02847452, 0.02242774, 0.0181301 , 0.01330781, 0.00807857, 0.00336469, 0.00122287]

    plt.errorbar(midbins,hsc,yerr=dhsc,color='red',marker='o',label='vs. HSC completeness')
    plt.errorbar(midbins,deep,yerr=ddeep,color='blue',marker='o',linestyle = '--',label='Deep fields completeness')
    plt.errorbar(midbins,balrog,yerr=dbalrog,color='black',marker='o',linestyle = '-.',label='Balrog completeness')

    plt.xticks(np.arange(minmax[0], minmax[1]+1, 0.5))
    plt.hlines(0.95,minmax[0],minmax[1])
    #plt.xlabel("bdf_mag_"+band_select+"/sof_cm_"+band_select,fontsize=14)
    plt.xlabel(band_select+"-band model magnitude")
    plt.ylabel('Detection completeness')
    plt.ylim(0.0,1.0)
    plt.title('Detection completeness for extended objects, SN-X3 field')
    plt.legend(loc='lower left')
    plt.grid(True)
    plt.savefig('figs/completeness_galaxies_snx3_v2.png')

elif region == 'w05':
    
    y1 = [0.95618379, 0.95682163, 0.95789391, 0.9553775 , 0.95595987, 0.95693913, 0.93072682, 0.71870763, 0.24925742, 0.06346918]
    dy1 = [0.00468223, 0.00355227, 0.00274058, 0.00214611, 0.00172017, 0.00138502, 0.00110175, 0.00078118, 0.00037916, 0.00017321]
    y3 = [0.9704682 , 0.96998351, 0.97073744, 0.96809511, 0.96736301, 0.96919126, 0.95951468, 0.84280813, 0.39894591, 0.09669234]
    dy3 = [0.00471707, 0.00357662, 0.00275889, 0.00216035, 0.0017304, 0.00139386, 0.00111866, 0.00084594, 0.00047968, 0.00021379]

    plt.errorbar(midbins,y1,yerr=dy1,color='red',marker='o',label='Y1 Gold completeness')
    plt.errorbar(midbins,y3,yerr=dy3,color='blue',marker='o',linestyle = '--',label='Y3 Gold completeness')

    plt.xticks(np.arange(minmax[0], minmax[1]+1, 0.5))
    plt.hlines(0.95,minmax[0],minmax[1])
    plt.xlabel(band_select+"-band model magnitude")
    plt.ylabel('Detection completeness')
    plt.ylim(0.0,1.0)
    plt.title('Detection completeness for extended objects, HSC W05 field')
    plt.legend(loc='lower left')
    plt.grid(True)
    plt.savefig('figs/completeness_galaxies_w05_v2.png')
